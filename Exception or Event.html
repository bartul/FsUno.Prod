<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- 
      The Exception or Event ?
 parameters will be replaced with the 
      document title extracted from the <h1> element or
      file name, if there is no <h1> heading
    -->
    <title>Exception or Event ?
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FsUno.Prod">
    <meta name="author" content="Jérémie Chassaing">
    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="content/style.css" />
    <script src="content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://github.com/thinkbeforecoding/FsUno.Prod/">github page</a></li>
        </ul>
        <h3 class="muted">FsUno.Prod</h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          <h1>Exception or Event ?</h1>

<p>In the original FsUno code, I raised exceptions when the player played the wrong card, or played at wrong turn. I changed it to events in FsUno.Prod.</p>

<p>I still raise some exception when the player count is two or less when starting the game, or when the game is started twice.</p>

<p>The question is: When should we use events, and when should you use exceptions ?</p>

<h2>Prior reading</h2>

<p>A few years back, I wrote a post on the subjet: <a href="http://thinkbeforecoding.com/post/2009/12/10/Business-Errors-are-Just-Ordinary-Events">Business Errors are Just Ordinary Events</a></p>

<p>And it makes a distinction betweens several cases...</p>

<h2>Broken invariants</h2>

<p>This should never happen since the aggregate is here to preserve invariants.</p>

<p>easy, next...</p>

<h2>Invalid commands</h2>

<p>There a two cases here:</p>

<h3>Command data is meaningless</h3>

<p>Try to avoid it as much as you can by designing command types that cannot represent invalid case. When it's not possible, validate the data and raise an exception. The caller is responsible to not call the aggregate with such command bit still check it at the aggregate boundary to be sure.</p>

<p>This is the case when the game is requested to start with two players. The UI should not enable this scenario, but we still validate this and throw an exception in case a problem occures, or a malicious client tries to fool the system with an invalid command.</p>

<p>It could be possible to use a type for player count that cannot be constructed with less than two players. Checking player count inside the aggregate is then useless.</p>

<h3>The command leads to an invalid state</h3>

<p>This should also not happen. The client is responsible to not send this command in the current application state. To be sure to avoid any problem, validate this and raise an exception.</p>

<p>This is the case when the game is requested to start again. The UI should not enable this scenario.</p>

<p>In all cases, exceptions are raised in cases that <strong>should not</strong> happen !</p>

<h2>Other cases</h2>

<p>Other cases are part of the domain, and should raise an <strong>event</strong>. This cases are modeled as domain events representing things that can happen - even if rarely - in the domain.</p>

<p>This is the case when a player plays the wrong card. The rest of the process should be notified of this because the card should return in player's hand, and the player will get a penalty for not knowing the rule !</p>

<p>When a player plays at wrong turn the result depends on the kind of game - and UI - you want to implement:</p>

<ul>
<li><p>when the UI enforces player turns so that player can only take action when expected by the rules, a player should not be able to play a card out of turn. In the case, the aggregate could simply raise an exception, because this should simply not happen. No need to handle this.</p></li>
<li><p>When the game is more wild, and the UI let player play whenever they want, players have no UI safety net and can play at wrong turn. The aggregate should emit an event because playing at wrong turn is now part of the game, and some reactions should follow.</p></li>
</ul>

<p>This should make this kind of desing decision easier...</p>

                    
        </div>
        <div class="span3">

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">FsUno.Prod</li>
            <li><a href=index.html>The Journey</a></li>
            <li><a href=Why%20Uno.html>Why Uno</a></li>
            <li><a href=Why%20FSharp.html>Why FSharp</a></li>
            <li><a href=Why%20FsUno.Prod.html>Why FsUno.Prod</a></li>
            <li><a href=The%20Digit%20type.html>The Digit type</a></li>
            <li><a href=About%20Streams%20Lifetime.html>About Streams Lifetime</a></li>
            <li><a href=Event%20vs%20Command%20Sourcing.html>Event vs Command Sourcing</a></li>
            <li><a href=Designing%20Aggregates.html>Designing Aggregates</a></li>
            <li><a href=Dynamical%20Sytems.html>Dynamical Sytems</a></li>
            <li><a href=Exception%20or%20Event.html>Exception or Event</a></li>
            <!--li><a href="index.html">Home page</a></!--li>
            <!--

              Here you can add links to other pages of the documentation 
              The 'divider' element creates a separator and additional
              'nav-header' can be used to add sub-headings in the menu:

              * <li class="divider"></li>
              * <li><a href="...">...</a></li>
              * <li class="nav-header">Sub-heading</li>

            -->
          </ul>
        </div>
      </div>
    </div>
    <a href="https://github.com/thinkbeforecoding/FsUno.Prod/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  </body>
</html>