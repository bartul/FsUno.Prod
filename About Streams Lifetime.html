<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- 
      The About Streams Lifetime
 parameters will be replaced with the 
      document title extracted from the <h1> element or
      file name, if there is no <h1> heading
    -->
    <title>About Streams Lifetime
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FsUno.Prod">
    <meta name="author" content="Jérémie Chassaing">
    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="content/style.css" />
    <script src="content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://github.com/thinkbeforecoding/FsUno.Prod/">github page</a></li>
        </ul>
        <h3 class="muted">FsUno.Prod</h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          <h1>About Streams Lifetime</h1>
<p><em>tldr; Streams should not go unbounded, find a limit in the domain or create one.</em></p>
<p><em>2016-08-25</em></p>
<h1>Stream life</h1>
<p>It took me several years to see the point, but I think it's crucial for your own sanity.</p>
<p>In Event Sourcing, people - me included - often say</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">You</span> <span class="i">can</span> <span class="i">rebuild</span> <span class="i">the</span> <span class="i">system</span> <span class="i">from</span> <span class="i">its</span> <span class="i">initial</span> <span class="i">state</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
<p>This is true, but it's only part of the story.</p>
<p>Greg told me how he was saving thousands of events per second, every second every day. So I
was thinking saving ten to one hundrerd per second would be easy to manage.</p>
<p>But after a few month or a few years, things got difficult to maintain, and it could only
get worse.</p>
<p>What I noticed, and was really implicit so I heard nobody talk about it before, is that Greg
was working on stock market data. Stock exchange open typicaly from 9:30 a.m. to 4:00 p.m. ( <a href="https://www.nyse.com/markets/hours-calendars">NYSE</a> ).</p>
<p>So at 4 PM, you can stop, aggregate the data, and start from consolidated data at 9:30 AM
the next day, starting new streams.</p>
<p>It's quite different in contexts where there's no <a href="https://www.youtube.com/watch?v=CIe3uvRWleo">bell ringing</a>...</p>
<h2>The bell</h2>
<p>Not all streams open in the morning and close at 4 PM.</p>
<p>You should still try to see wheter the underlying aggregate as a pre existing defined lifetime.</p>
<p>For instance, the price of an hotel room for as specific day in the future will not change anymore
once that day has passed.</p>
<p>Some business processes have a limited lifetime and you should look for it and see whether the
quantity of events that can happen in this lifetime is manageable. After the expiry date, the stream
can be closed.</p>
<h2>Unlimited streams.</h2>
<p>Some streams seem unlimited in duration... But a stream containing events generated by a human will
not exceed his life - max 120 years for now - and anyway not his usage of the system - a few years.</p>
<p>Humans don't do more that a few hundrend or thousands manual events a day which make such stream still
limited in size.</p>
<p>This can still be a lot of events in the case of events generated from sensors. The same occures
for events created by automated systems, or groups of humans etc...</p>
<p>In this case always come back to what accountants do !</p>
<h2>Business years</h2>
<p>Accountants use business years to consolidate the ledger entries. The ledger would grow unbounded
without business years, which would prove difficult after a few years.</p>
<p>So each year, on a fixed date, accountants consolidate the ledger entries and start a new ledger
starting with previous year consolidated result. They start a new event stream.</p>
<p>When an error is found in a previous ledger, it's not modified. A compensating entry is added
to the current ledger.</p>
<p>For unbounded high volume streams, define business periods after which you consolidate the stream's
events before starting a new stream. You can then archive old events for auditing.</p>
<h2>Streams lifetime in FsUno</h2>
<p>Streams in FsUno don't last more than one game, which is quite limited in time.</p>
<p>The typical number of events in a Uno Game is under 200 - this is just guess work, nothing scientfic.</p>
<p>This is far bellow the limit of unmanageability.</p>
<p>You should still be carefull about game automation. If some players create scrappers to automate games,
you could end up with high speed long games that could potentialy exceed your expectations.</p>
<p>To avoid this, you could put a throtelling on game inputs to avoid high speed algorithms to compete.</p>
<p>Or accept it, and gradually split game streams after a given number of events, or limit game length in time
depending on your business objectives.</p>

                    
        </div>
        <div class="span3">

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">FsUno.Prod</li>
            <li><a href=index.html>The Journey</a></li>
            <li><a href=Why%20Uno.html>Why Uno</a></li>
            <li><a href=Why%20FSharp.html>Why FSharp</a></li>
            <li><a href=Why%20FsUno.Prod.html>Why FsUno.Prod</a></li>
            <li><a href=The%20Digit%20type.html>The Digit type</a></li>
            <li><a href=About%20Streams%20Lifetime.html>About Streams Lifetime</a></li>
            <li><a href=Event%20vs%20Command%20Sourcing.html>Event vs Command Sourcing</a></li>
            <li><a href=Designing%20Aggregates.html>Designing Aggregates</a></li>
            <li><a href=Dynamical%20Systems.html>Dynamical Systems</a></li>
            <li><a href=Exception%20or%20Event.html>Exception or Event</a></li>
            <!--li><a href="index.html">Home page</a></!--li>
            <!--

              Here you can add links to other pages of the documentation 
              The 'divider' element creates a separator and additional
              'nav-header' can be used to add sub-headings in the menu:

              * <li class="divider"></li>
              * <li><a href="...">...</a></li>
              * <li class="nav-header">Sub-heading</li>

            -->
          </ul>
        </div>
      </div>
    </div>
    <a href="https://github.com/thinkbeforecoding/FsUno.Prod/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  </body>
</html>